# 3-3. PK, λ°μ΄ν„° κµ¬μ΅°λ¥Ό μ§€λ°°ν•λ” λ§μ¤ν„°ν‚¤ π”‘

## π“– ν•™μµ λ©ν‘
- κΈ°λ³Έν‚¤(Primary Key)μ κ°λ…κ³Ό μ¤‘μ”μ„± μ΄ν•΄
- ν¨κ³Όμ μΈ κΈ°λ³Έν‚¤ μ„¤κ³„ λ°©λ²• ν•™μµ
- κΈ°λ³Έν‚¤κ°€ λ°μ΄ν„° κµ¬μ΅°μ— λ―ΈμΉλ” μν–¥ νμ•…

## π― κΈ°λ³Έν‚¤(Primary Key)λ€?

### μ •μ
**κΈ°λ³Έν‚¤(PK)**λ” ν…μ΄λΈ”μ κ° ν–‰μ„ μ μΌν•κ² μ‹λ³„ν•λ” μ»¬λΌ λλ” μ»¬λΌμ μ΅°ν•©μΌλ΅,
λ°μ΄ν„°λ² μ΄μ¤μ—μ„ κ°€μ¥ μ¤‘μ”ν• μ μ•½μ΅°κ±΄μ…λ‹λ‹¤.

### μ—΄μ‡ μ™€μ λΉ„μ 
```
λ¬Όλ¦¬μ  μ—΄μ‡         κΈ°λ³Έν‚¤
β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€  β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
μ§‘ λ¬Έμ„ μ—¬λ” μ μΌν• ν‚¤  β†’  ν–‰μ„ μ°Ύλ” μ μΌν• ν‚¤
λ³µμ‚¬ λ¶κ°€λ¥ν• κ³ μ μ„±    β†’  μ¤‘λ³µ λ¶κ°€λ¥ν• κ³ μ μ„±
λ¶„μ‹¤ν•λ©΄ ν° λ¬Έμ        β†’  μ—†μΌλ©΄ λ°μ΄ν„° λ¬΄κ²°μ„± λ¬Έμ 
```

## π” κΈ°λ³Έν‚¤μ νΉμ„±

### 1. μ μΌμ„± (Uniqueness)
```sql
-- κΈ°λ³Έν‚¤λ” ν…μ΄λΈ” λ‚΄μ—μ„ μ μΌν•΄μ•Ό ν•¨
CREATE TABLE κ³ κ° (
    κ³ κ°ID VARCHAR(10) PRIMARY KEY,  -- μ μΌν• κ°’λ§ ν—μ©
    κ³ κ°λ… VARCHAR(50),
    μ΄λ©”μΌ VARCHAR(100)
);

-- μ¤‘λ³µ κ°’ μ…λ ¥ μ‹λ„ μ‹ μ¤λ¥ λ°μƒ
INSERT INTO κ³ κ° VALUES ('CU00000001', 'ν™κΈΈλ™', 'hong@email.com');
INSERT INTO κ³ κ° VALUES ('CU00000001', 'κΉ€μ² μ', 'kim@email.com');  -- μ¤λ¥!
```

### 2. λΉ„μ–΄μμ§€ μ•μ (Not Null)
```sql
-- κΈ°λ³Έν‚¤λ” NULL κ°’μ„ κ°€μ§ μ μ—†μ
INSERT INTO κ³ κ° VALUES (NULL, 'μ΄μν¬', 'lee@email.com');  -- μ¤λ¥!
INSERT INTO κ³ κ° VALUES ('', 'λ°•λ―Όμ', 'park@email.com');   -- μ¤λ¥!
```

### 3. λ¶λ³€μ„± (Immutability)
```sql
-- κΈ°λ³Έν‚¤ κ°’μ€ κ°€κΈ‰μ  λ³€κ²½ν•μ§€ μ•μ•„μ•Ό ν•¨
-- λ³€κ²½ μ‹ μ°Έμ΅°ν•λ” λ¨λ“  μ™Έλν‚¤λ„ ν•¨κ» λ³€κ²½ ν•„μ”
UPDATE κ³ κ° SET κ³ κ°ID = 'CU00000999' WHERE κ³ κ°ID = 'CU00000001';
-- μ΄ κ²½μ° μ£Όλ¬Έ, κ²°μ  λ“± λ¨λ“  κ΄€λ ¨ ν…μ΄λΈ”μ μ™Έλν‚¤λ„ λ³€κ²½ ν•„μ”
```

## π—οΈ κΈ°λ³Έν‚¤ μ„¤κ³„ μ „λµ

### μ „λµ 1: μμ—°ν‚¤ (Natural Key)
```
μ •μ: λΉ„μ¦λ‹μ¤μ—μ„ μμ—°μ¤λ½κ² μ‚¬μ©λλ” μ‹λ³„μ

μ¥μ :
β… λΉ„μ¦λ‹μ¤ μλ―Έκ°€ λ…ν™•
β… μ‚¬μ©μκ°€ μ΄ν•΄ν•κΈ° μ‰¬μ›€
β… λ³„λ„ ν‚¤ μƒμ„± λ¶ν•„μ”

λ‹¨μ :
β κ°’μ΄ λ³€κ²½λ  κ°€λ¥μ„±
β λ³µν•©ν‚¤κ°€ λ  κ°€λ¥μ„±
β μ„±λ¥ μ΄μ κ°€λ¥μ„±
```

#### μμ—°ν‚¤ μμ‹
```sql
-- μ£Όλ―Όλ“±λ΅λ²νΈλ¥Ό κΈ°λ³Έν‚¤λ΅ μ‚¬μ©
CREATE TABLE κ°μΈκ³ κ° (
    μ£Όλ―Όλ“±λ΅λ²νΈ VARCHAR(13) PRIMARY KEY,
    κ³ κ°λ… VARCHAR(50),
    μƒλ…„μ›”μΌ DATE
);

-- μ‚¬μ—…μλ“±λ΅λ²νΈλ¥Ό κΈ°λ³Έν‚¤λ΅ μ‚¬μ©  
CREATE TABLE λ²•μΈκ³ κ° (
    μ‚¬μ—…μλ“±λ΅λ²νΈ VARCHAR(10) PRIMARY KEY,
    λ²•μΈλ… VARCHAR(100),
    λ€ν‘μλ… VARCHAR(50)
);
```

### μ „λµ 2: λ€λ¦¬ν‚¤ (Surrogate Key)
```
μ •μ: μ‹μ¤ν…μ—μ„ μΈμ„μ μΌλ΅ μƒμ„±ν•λ” μ‹λ³„μ

μ¥μ :
β… κ°’μ΄ λ³€κ²½λμ§€ μ•μ
β… λ‹¨μν• κµ¬μ΅° (λ‹¨μΌ μ»¬λΌ)
β… μ„±λ¥ μµμ ν™” μ©μ΄
β… λΉ„μ¦λ‹μ¤ κ·μΉ™ λ³€κ²½μ— λ…λ¦½μ 

λ‹¨μ :
β λΉ„μ¦λ‹μ¤ μλ―Έ μ—†μ
β λ³„λ„ ν‚¤ μƒμ„± λ©”μ»¤λ‹μ¦ ν•„μ”
β μ €μ¥ κ³µκ°„ μ¶”κ°€ ν•„μ”
```

#### λ€λ¦¬ν‚¤ μμ‹
```sql
-- μ‹ν€€μ¤λ¥Ό μ΄μ©ν• λ€λ¦¬ν‚¤
CREATE SEQUENCE κ³ κ°_SEQ START WITH 1;

CREATE TABLE κ³ κ° (
    κ³ κ°ID NUMBER PRIMARY KEY,           -- λ€λ¦¬ν‚¤
    μ£Όλ―Όλ“±λ΅λ²νΈ VARCHAR(13) UNIQUE,     -- μμ—°ν‚¤λ” μ λ‹ν¬ μ μ•½μ΅°κ±΄
    κ³ κ°λ… VARCHAR(50),
    μƒλ…„μ›”μΌ DATE
);

-- μλ―Έμλ” ν•νƒμ λ€λ¦¬ν‚¤
CREATE TABLE μ£Όλ¬Έ (
    μ£Όλ¬Έλ²νΈ VARCHAR(15) PRIMARY KEY,    -- OR + YYYYMMDD + μλ²
    κ³ κ°ID NUMBER,
    μ£Όλ¬ΈμΌμ DATE,
    μ΄κΈμ•΅ NUMBER
);
```

### μ „λµ 3: λ³µν•©ν‚¤ (Composite Key)
```
μ •μ: μ—¬λ¬ μ»¬λΌμ„ μ΅°ν•©ν•μ—¬ λ§λ“  κΈ°λ³Έν‚¤

μ‚¬μ© μ‹κΈ°:
- μμ—°μ¤λ¬μ΄ λ‹¨μΌ μ‹λ³„μκ°€ μ—†λ” κ²½μ°
- μ—°κ²° ν…μ΄λΈ” (M:N κ΄€κ³„ ν•΄κ²°)
- μ΄λ ¥ ν…μ΄λΈ” (μ‹κ°„ μ°¨μ› ν¬ν•¨)
```

#### λ³µν•©ν‚¤ μμ‹
```sql
-- μ£Όλ¬Έμƒμ„Έ ν…μ΄λΈ” (μ£Όλ¬Έλ²νΈ + μλ²)
CREATE TABLE μ£Όλ¬Έμƒμ„Έ (
    μ£Όλ¬Έλ²νΈ VARCHAR(15),
    μλ² NUMBER,
    μƒν’μ½”λ“ VARCHAR(10),
    μλ‰ NUMBER,
    λ‹¨κ°€ NUMBER,
    PRIMARY KEY (μ£Όλ¬Έλ²νΈ, μλ²)
);

-- κ³ κ°λ“±κΈ‰μ΄λ ¥ ν…μ΄λΈ” (κ³ κ°ID + μ μ©μΌμ)
CREATE TABLE κ³ κ°λ“±κΈ‰μ΄λ ¥ (
    κ³ κ°ID NUMBER,
    μ μ©μΌμ DATE,
    λ“±κΈ‰μ½”λ“ VARCHAR(10),
    λ³€κ²½μ‚¬μ  VARCHAR(200),
    PRIMARY KEY (κ³ κ°ID, μ μ©μΌμ)
);
```

## π“ κΈ°λ³Έν‚¤ μ„¤κ³„ κ°€μ΄λ“λΌμΈ

### κ°€μ΄λ“λΌμΈ 1: λ‹¨μμ„± μ°μ„ 
```
κ¶μ¥μ‚¬ν•­:
β… λ‹¨μΌ μ»¬λΌ κΈ°λ³Έν‚¤ μ„ νΈ
β… μ«μν• λ°μ΄ν„° νƒ€μ… μ„ νΈ
β… κ³ μ • κΈΈμ΄ μ„ νΈ

μμ‹:
-- μΆ‹μ€ μ
κ³ κ°ID NUMBER(10)
μ£Όλ¬Έλ²νΈ VARCHAR(15)

-- ν”Όν•΄μ•Ό ν•  μ  
λ³µν•©ν‚¤ (κ³ κ°λ…, μƒλ…„μ›”μΌ, μ „ν™”λ²νΈ)
κ°€λ³€κΈΈμ΄ (μ΄λ©”μΌμ£Όμ†)
```

### κ°€μ΄λ“λΌμΈ 2: μ•μ •μ„± λ³΄μ¥
```
κ³ λ ¤μ‚¬ν•­:
- κ°’μ΄ λ³€κ²½λ  κ°€λ¥μ„± μµμ†ν™”
- λΉ„μ¦λ‹μ¤ κ·μΉ™ λ³€κ²½μ— λ…λ¦½μ 
- μ™Έλ¶€ μ‹μ¤ν… μμ΅΄μ„± μµμ†ν™”

μμ‹:
-- μ•μ •μ μΈ ν‚¤
κ³ κ°ID (μ‹μ¤ν… μƒμ„±)
μ£Όλ¬Έλ²νΈ (κ·μΉ™ κΈ°λ° μƒμ„±)

-- λ¶μ•μ •ν• ν‚¤
μ΄λ©”μΌμ£Όμ† (μ‚¬μ©μκ°€ λ³€κ²½ κ°€λ¥)
μ „ν™”λ²νΈ (ν†µμ‹ μ‚¬ λ³€κ²½ μ‹ λ³€κ²½)
```

### κ°€μ΄λ“λΌμΈ 3: μ„±λ¥ κ³ λ ¤
```
μ„±λ¥ μµμ ν™” μ”μ†:
- μΈλ±μ¤ ν¨μ¨μ„±
- μ΅°μΈ μ„±λ¥
- μ €μ¥ κ³µκ°„ ν¨μ¨μ„±
- μ •λ ¬ μ„±λ¥

μμ‹:
-- μ„±λ¥ μ°μ
NUMBER(10)        -- 4λ°”μ΄νΈ, λΉ λ¥Έ λΉ„κµ
VARCHAR(10)       -- κ³ μ • κΈΈμ΄, μμΈ΅ κ°€λ¥

-- μ„±λ¥ μ €ν• κ°€λ¥
VARCHAR(100)      -- κ°€λ³€ κΈΈμ΄, ν° ν¬κΈ°
CLOB              -- λ€μ©λ‰, λλ¦° λΉ„κµ
```

## π¨ κΈ°λ³Έν‚¤ λ…λ… κ·μΉ™

### κ·μΉ™ 1: μΌκ΄€λ ν¨ν„΄
```
ν¨ν„΄ μμ‹:
[ν…μ΄λΈ”λ…] + ID
- κ³ κ°ID, μƒν’ID, μ£Όλ¬ΈID

[ν…μ΄λΈ”λ…] + λ²νΈ  
- μ£Όλ¬Έλ²νΈ, μ†΅μ¥λ²νΈ, κ³„μ•½λ²νΈ

[ν…μ΄λΈ”λ…] + μ½”λ“
- μƒν’μ½”λ“, μ§€μ—­μ½”λ“, λ¶€μ„μ½”λ“
```

### κ·μΉ™ 2: μλ―Έμλ” ν•μ‹
```sql
-- μλ―Έμλ” κΈ°λ³Έν‚¤ ν•μ‹
CREATE TABLE μ£Όλ¬Έ (
    μ£Όλ¬Έλ²νΈ VARCHAR(15) PRIMARY KEY  -- OR + YYYYMMDD + 6μλ¦¬μλ²
    -- μ: OR202401150000001
);

CREATE TABLE μƒν’ (
    μƒν’μ½”λ“ VARCHAR(10) PRIMARY KEY  -- μΉ΄ν…κ³ λ¦¬(2) + λΈλλ“(2) + μλ²(6)
    -- μ: ELSA000001 (μ „μμ ν’-μ‚Όμ„±-μλ²)
);

CREATE TABLE κ³ κ° (
    κ³ κ°ID VARCHAR(10) PRIMARY KEY    -- CU + 8μλ¦¬μλ²
    -- μ: CU12345678
);
```

## π”§ κΈ°λ³Έν‚¤μ™€ μ„±λ¥

### μΈλ±μ¤ μλ™ μƒμ„±
```sql
-- κΈ°λ³Έν‚¤ μƒμ„± μ‹ μλ™μΌλ΅ μ λ‹ν¬ μΈλ±μ¤ μƒμ„±
CREATE TABLE κ³ κ° (
    κ³ κ°ID NUMBER PRIMARY KEY,  -- μλ™μΌλ΅ μΈλ±μ¤ μƒμ„±λ¨
    κ³ κ°λ… VARCHAR(50)
);

-- μ΅°ν μ„±λ¥ μµμ ν™”
SELECT * FROM κ³ κ° WHERE κ³ κ°ID = 12345;  -- μΈλ±μ¤ μ‚¬μ©μΌλ΅ λΉ λ¥Έ μ΅°ν
```

### ν΄λ¬μ¤ν„°λ§ ν¨κ³Ό
```sql
-- κΈ°λ³Έν‚¤ μμ„λ΅ λ°μ΄ν„°κ°€ λ¬Όλ¦¬μ μΌλ΅ μ •λ ¬λ¨ (DBMSμ— λ”°λΌ λ‹¤λ¦„)
-- λ²”μ„ μ΅°ν μ‹ μ„±λ¥ ν–¥μƒ
SELECT * FROM μ£Όλ¬Έ 
WHERE μ£Όλ¬Έλ²νΈ BETWEEN 'OR20240101000001' AND 'OR20240131999999';
```

### μ™Έλν‚¤ μ°Έμ΅° μ„±λ¥
```sql
-- κΈ°λ³Έν‚¤λ¥Ό μ°Έμ΅°ν•λ” μ™Έλν‚¤ μ΅°μΈ μ„±λ¥ μµμ ν™”
SELECT c.κ³ κ°λ…, o.μ£Όλ¬ΈμΌμ, o.μ΄κΈμ•΅
FROM κ³ κ° c
JOIN μ£Όλ¬Έ o ON c.κ³ κ°ID = o.κ³ κ°ID  -- κΈ°λ³Έν‚¤-μ™Έλν‚¤ μ΅°μΈμΌλ΅ λΉ λ¥Έ μ„±λ¥
WHERE c.κ³ κ°ID = 12345;
```

## π’΅ κΈ°λ³Έν‚¤ μ„¤κ³„ μ‹¤λ¬΄ ν

### ν 1: λΉ„μ¦λ‹μ¤ ν‚¤μ™€ κΈ°μ  ν‚¤ λ¶„λ¦¬
```sql
-- κΈ°μ μ  κΈ°λ³Έν‚¤ + λΉ„μ¦λ‹μ¤ μ λ‹ν¬ ν‚¤ μ΅°ν•©
CREATE TABLE κ³ κ° (
    κ³ κ°ID NUMBER PRIMARY KEY,              -- κΈ°μ μ  κΈ°λ³Έν‚¤ (λ€λ¦¬ν‚¤)
    κ³ κ°λ²νΈ VARCHAR(10) UNIQUE NOT NULL,   -- λΉ„μ¦λ‹μ¤ ν‚¤ (μμ—°ν‚¤)
    κ³ κ°λ… VARCHAR(50),
    μ΄λ©”μΌ VARCHAR(100) UNIQUE
);
```

### ν 2: μλ―Έμλ” ν‚¤ μƒμ„± ν•¨μ
```sql
-- μ£Όλ¬Έλ²νΈ μƒμ„± ν•¨μ μμ‹
CREATE OR REPLACE FUNCTION μ£Όλ¬Έλ²νΈμƒμ„±
RETURN VARCHAR2
IS
    v_seq NUMBER;
    v_order_no VARCHAR2(15);
BEGIN
    SELECT μ£Όλ¬Έλ²νΈ_SEQ.NEXTVAL INTO v_seq FROM DUAL;
    v_order_no := 'OR' || TO_CHAR(SYSDATE, 'YYYYMMDD') || 
                  LPAD(v_seq, 6, '0');
    RETURN v_order_no;
END;
```

### ν 3: κΈ°λ³Έν‚¤ λ³€κ²½ μ‹ κ³ λ ¤μ‚¬ν•­
```sql
-- κΈ°λ³Έν‚¤ λ³€κ²½ μ „ μν–¥λ„ λ¶„μ„
SELECT table_name, constraint_name
FROM user_constraints
WHERE r_constraint_name = 'PK_κ³ κ°';  -- κ³ κ° ν…μ΄λΈ”μ„ μ°Έμ΅°ν•λ” μ™Έλν‚¤ μ΅°ν

-- λ³€κ²½ μμ„
-- 1. μ™Έλν‚¤ μ μ•½μ΅°κ±΄ μ‚­μ 
-- 2. κΈ°λ³Έν‚¤ κ°’ λ³€κ²½
-- 3. μ°Έμ΅° ν…μ΄λΈ”μ μ™Έλν‚¤ κ°’ λ³€κ²½
-- 4. μ™Έλν‚¤ μ μ•½μ΅°κ±΄ μ¬μƒμ„±
```

## π― μ²΄ν¬λ¦¬μ¤νΈ: μΆ‹μ€ κΈ°λ³Έν‚¤ μ„¤κ³„μΈκ°€?

### κΈ°λ¥μ  μΈ΅λ©΄
- [ ] κ° ν–‰μ„ μ μΌν•κ² μ‹λ³„ν•λ”κ°€?
- [ ] NULL κ°’μ΄ μ—†λ”κ°€?
- [ ] κ°’μ΄ λ³€κ²½λ  κ°€λ¥μ„±μ΄ λ‚®μ€κ°€?
- [ ] λΉ„μ¦λ‹μ¤ κ·μΉ™κ³Ό λ…λ¦½μ μΈκ°€?

### μ„±λ¥μ  μΈ΅λ©΄
- [ ] μΈλ±μ¤ ν¨μ¨μ„±μ΄ μΆ‹μ€κ°€?
- [ ] μ΅°μΈ μ„±λ¥μ΄ μµμ ν™”λλ”κ°€?
- [ ] μ €μ¥ κ³µκ°„μ΄ ν¨μ¨μ μΈκ°€?
- [ ] μ •λ ¬ μ„±λ¥μ΄ μΆ‹μ€κ°€?

### κ΄€λ¦¬μ  μΈ΅λ©΄
- [ ] λ…λ… κ·μΉ™μ„ μ¤€μν–λ”κ°€?
- [ ] μΌκ΄€λ ν¨ν„΄μ„ μ‚¬μ©ν–λ”κ°€?
- [ ] μ΄ν•΄ν•κΈ° μ‰¬μ΄ ν•μ‹μΈκ°€?
- [ ] ν™•μ¥μ„±μ„ κ³ λ ¤ν–λ”κ°€?

---

**λ‹¤μ**: [3-4. FK, λ¶€λ¨ μ—†μ΄λ” μ‚΄ μ μ—†μ§€λ§](./04-foreign-key.md)