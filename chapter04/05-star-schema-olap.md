# 4-5. 차원 모델링 용어 탐방(1): 스타 스키마, OLAP 큐브 ⭐

## 📖 학습 목표
- 스타 스키마의 구조와 특징 이해
- OLAP 큐브의 개념과 활용 방법 학습
- 두 개념의 관계와 차이점 파악

## 🌟 스타 스키마 (Star Schema)

### 정의
**스타 스키마**는 중앙의 팩트 테이블을 여러 차원 테이블이 둘러싸는 
별 모양의 데이터 모델 구조입니다.

### 별자리와의 비유
```
밤하늘의 별자리          스타 스키마
─────────────────       ─────────────────
중심의 밝은 별      →    팩트 테이블 (중심)
주변의 작은 별들    →    차원 테이블들 (주변)
별들 간의 연결      →    외래키 관계
별자리의 모양       →    비즈니스 프로세스
관측자의 시점       →    분석 관점
```

## 📐 스타 스키마의 구조

### 기본 구조
```
        일자차원
           │
고객차원 ── 매출팩트 ── 상품차원
           │
        지역차원

특징:
- 1개의 팩트 테이블 (중심)
- N개의 차원 테이블 (주변)
- 직접적인 관계 (1단계 조인)
- 비정규화된 차원 테이블
```

### 실제 구현 예시
```sql
-- 중앙 팩트 테이블
CREATE TABLE 매출팩트 (
    매출팩트키 NUMBER PRIMARY KEY,
    일자키 NUMBER NOT NULL,
    고객키 NUMBER NOT NULL,
    상품키 NUMBER NOT NULL,
    지역키 NUMBER NOT NULL,
    매출금액 NUMBER(15,2),
    수량 NUMBER(10),
    할인금액 NUMBER(15,2),
    이익금액 NUMBER(15,2),
    FOREIGN KEY (일자키) REFERENCES 일자차원(일자키),
    FOREIGN KEY (고객키) REFERENCES 고객차원(고객키),
    FOREIGN KEY (상품키) REFERENCES 상품차원(상품키),
    FOREIGN KEY (지역키) REFERENCES 지역차원(지역키)
);

-- 차원 테이블들 (비정규화)
CREATE TABLE 일자차원 (
    일자키 NUMBER PRIMARY KEY,
    일자 DATE,
    년도 NUMBER(4),
    분기 NUMBER(1),
    월 NUMBER(2),
    일 NUMBER(2),
    요일명 VARCHAR(10),
    주말여부 CHAR(1),
    공휴일여부 CHAR(1),
    분기명 VARCHAR(10), -- '2024년 1분기'
    월명 VARCHAR(10)     -- '2024년 1월'
);

CREATE TABLE 고객차원 (
    고객키 NUMBER PRIMARY KEY,
    고객ID VARCHAR(10),
    고객명 VARCHAR(50),
    고객등급 VARCHAR(20),
    연령대 VARCHAR(10),
    성별 CHAR(1),
    지역 VARCHAR(50),
    가입일자 DATE,
    고객등급명 VARCHAR(30), -- 'VIP 고객'
    연령대명 VARCHAR(20)     -- '30대'
);
```

## 🎯 스타 스키마의 장점

### 1. 단순성과 직관성
```
사용자 질문: "2024년 1분기 VIP 고객의 전자제품 매출은?"

SQL 쿼리:
SELECT 
    SUM(f.매출금액) as 총매출,
    COUNT(*) as 거래건수
FROM 매출팩트 f
JOIN 일자차원 d ON f.일자키 = d.일자키
JOIN 고객차원 c ON f.고객키 = c.고객키
JOIN 상품차원 p ON f.상품키 = p.상품키
WHERE d.년도 = 2024 
  AND d.분기 = 1
  AND c.고객등급 = 'VIP'
  AND p.대분류 = '전자제품';

→ 질문과 쿼리가 직관적으로 매칭
```

### 2. 뛰어난 성능
```
성능 최적화 요소:
- 최소한의 조인 (보통 2-5개)
- 비정규화로 인한 조인 감소
- 효율적인 인덱스 활용
- 병렬 처리 최적화

성능 비교:
정규화 모델: 
SELECT ... FROM A 
JOIN B ON ... JOIN C ON ... JOIN D ON ... 
JOIN E ON ... JOIN F ON ... (6개 조인)
→ 실행시간: 15초

스타 스키마:
SELECT ... FROM 팩트 
JOIN 차원A ON ... JOIN 차원B ON ... (2개 조인)
→ 실행시간: 2초
```

### 3. BI 도구 친화성
```
BI 도구 최적화:
- Tableau, Power BI 등에서 자동 인식
- 드래그 앤 드롭 분석 지원
- 자동 집계 및 계산
- 시각화 최적화

예시 (Tableau):
차원: 년도, 분기, 고객등급 (드래그)
측정값: 매출금액 (드롭)
→ 자동으로 적절한 차트 생성
```

## 🧊 OLAP 큐브 (OLAP Cube)

### 정의
**OLAP 큐브**는 다차원 데이터를 3차원 정육면체 형태로 표현한 논리적 구조로,
빠른 분석을 위해 데이터를 사전 집계하여 저장합니다.

### 루빅스 큐브와의 비유
```
루빅스 큐브              OLAP 큐브
─────────────────       ─────────────────
3차원 구조          →    다차원 데이터 구조
각 면의 색깔        →    차원별 분류
큐브 회전           →    차원 변경 (피벗)
패턴 찾기           →    데이터 패턴 분석
빠른 조작           →    빠른 분석
```

## 📊 OLAP 큐브의 구조

### 3차원 큐브 예시
```
차원 구성:
X축: 시간 (년, 분기, 월)
Y축: 지역 (국가, 시도, 시군구)  
Z축: 상품 (카테고리, 브랜드, 모델)

측정값: 매출금액

큐브 셀 예시:
[2024년, 서울, 스마트폰] = 1,500만원
[2024년, 부산, 노트북] = 800만원
[2023년, 대구, 태블릿] = 600만원
```

### 다차원 확장
```
실제로는 3차원 이상:
- 시간 차원
- 지역 차원  
- 상품 차원
- 고객 차원
- 채널 차원
- 프로모션 차원

→ N차원 하이퍼큐브
```

## 🔄 OLAP 연산

### 1. 드릴다운 (Drill-Down)
```
상위 레벨에서 하위 레벨로 이동

예시:
년도별 매출 → 분기별 매출 → 월별 매출 → 일별 매출

SQL:
-- 년도별
SELECT 년도, SUM(매출금액) FROM ... GROUP BY 년도;

-- 분기별 (드릴다운)
SELECT 년도, 분기, SUM(매출금액) FROM ... GROUP BY 년도, 분기;
```

### 2. 롤업 (Roll-Up)
```
하위 레벨에서 상위 레벨로 이동

예시:
일별 매출 → 월별 매출 → 분기별 매출 → 년도별 매출

SQL:
-- 월별
SELECT 년도, 월, SUM(매출금액) FROM ... GROUP BY 년도, 월;

-- 분기별 (롤업)
SELECT 년도, 분기, SUM(매출금액) FROM ... GROUP BY 년도, 분기;
```

### 3. 슬라이싱 (Slicing)
```
특정 차원의 특정 값으로 필터링

예시:
전체 큐브에서 "2024년" 데이터만 추출

SQL:
SELECT 지역, 상품카테고리, SUM(매출금액)
FROM 매출팩트 f
JOIN 일자차원 d ON f.일자키 = d.일자키
WHERE d.년도 = 2024
GROUP BY 지역, 상품카테고리;
```

### 4. 다이싱 (Dicing)
```
여러 차원에서 특정 범위로 필터링

예시:
"2024년 1-2분기" + "서울/부산" + "전자제품" 데이터 추출

SQL:
SELECT 분기, 지역, 브랜드, SUM(매출금액)
FROM 매출팩트 f
JOIN 일자차원 d ON f.일자키 = d.일자키
JOIN 지역차원 r ON f.지역키 = r.지역키
JOIN 상품차원 p ON f.상품키 = p.상품키
WHERE d.년도 = 2024 
  AND d.분기 IN (1, 2)
  AND r.시도 IN ('서울', '부산')
  AND p.대분류 = '전자제품'
GROUP BY 분기, 지역, 브랜드;
```

## 🔗 스타 스키마와 OLAP 큐브의 관계

### 상호 보완적 관계
```
스타 스키마 (물리적 구조):
- 데이터베이스 테이블 구조
- 실제 데이터 저장 방식
- SQL 쿼리로 접근

OLAP 큐브 (논리적 구조):
- 다차원 분석 관점
- 사용자 인터페이스
- MDX 쿼리로 접근

관계:
스타 스키마 → OLAP 큐브 생성 → 다차원 분석
```

### 구현 방식

#### MOLAP (Multidimensional OLAP)
```
특징:
- 사전 계산된 큐브 저장
- 빠른 응답 속도
- 제한된 데이터 크기

구현:
스타 스키마 → 큐브 빌드 → MOLAP 저장소

장점: 매우 빠른 성능
단점: 저장 공간 많이 필요, 실시간 업데이트 어려움
```

#### ROLAP (Relational OLAP)
```
특징:
- 관계형 DB에서 실시간 계산
- 큰 데이터 처리 가능
- 실시간 데이터 반영

구현:
스타 스키마 → SQL 쿼리 → 실시간 계산

장점: 실시간 데이터, 큰 데이터 처리
단점: 상대적으로 느린 성능
```

#### HOLAP (Hybrid OLAP)
```
특징:
- MOLAP + ROLAP 결합
- 요약 데이터는 큐브, 상세 데이터는 DB
- 균형잡힌 성능

구현:
집계 데이터 → MOLAP 큐브
상세 데이터 → ROLAP (스타 스키마)

장점: 성능과 유연성 균형
단점: 복잡한 관리
```

## 💡 실무 적용 가이드

### 스타 스키마 설계 팁
```
1. 적절한 차원 수 유지
   - 권장: 5-8개 차원
   - 너무 많으면: 복잡성 증가
   - 너무 적으면: 분석 제약

2. 차원 테이블 비정규화
   - 조회 성능 우선
   - 저장 공간보다 속도 중시
   - 사용자 편의성 고려

3. 팩트 테이블 최적화
   - 필요한 측정값만 포함
   - 적절한 데이터 타입 선택
   - 파티셔닝 고려
```

### OLAP 큐브 활용 팁
```
1. 적절한 집계 레벨 선택
   - 자주 사용하는 레벨 사전 계산
   - 너무 상세한 레벨은 제외
   - 성능과 저장공간 균형

2. 차원 계층 구조 활용
   - 드릴다운/롤업 경로 최적화
   - 자연스러운 계층 구조
   - 사용자 분석 패턴 반영

3. 정기적인 큐브 업데이트
   - 배치 처리 스케줄링
   - 증분 업데이트 활용
   - 성능 모니터링
```

## 🎯 체크리스트: 스타 스키마와 OLAP 큐브

### 스타 스키마 설계
- [ ] 중앙 팩트 테이블이 명확한가?
- [ ] 차원 테이블이 적절히 비정규화되었는가?
- [ ] 직관적인 테이블명을 사용했는가?
- [ ] 성능을 고려한 인덱스가 있는가?

### OLAP 큐브 구성
- [ ] 비즈니스 요구사항에 맞는 차원인가?
- [ ] 적절한 집계 레벨을 선택했는가?
- [ ] 드릴다운/롤업 경로가 자연스러운가?
- [ ] 성능과 저장공간을 고려했는가?

### 통합 활용
- [ ] 스타 스키마와 큐브가 일관성 있게 설계되었는가?
- [ ] 사용자 분석 패턴을 반영했는가?
- [ ] 적절한 OLAP 구현 방식을 선택했는가?
- [ ] 유지보수 계획이 수립되었는가?

---

**다음**: [4-6. 차원 모델링 용어 탐방(2): Fact, Fact 테이블](./06-fact-table.md)